<template>
	<view class="u-slider">
		<!-- #ifdef H5 || APP-VUE || MP-QQ || MP-WEIXIN -->
		<view
			class="u-slider__track"
			@tap="wxsModule.onClick"
			:change:prop="wxsModule.sizeReady"
			:prop="info"
			ref="slider"
			:class="[disabled ? 'u-slider--disabled' : '']"
			:style="{
				backgroundColor: inactiveColor,
				height: $u.addUnit(height),
			}"
		>
		<!-- #endif -->
		<!-- #ifdef APP-NVUE -->
		<view
			class="u-slider__track"
			ref="slider"
			:class="[disabled ? 'u-slider--disabled' : '']"
			:style="{
				backgroundColor: inactiveColor,
				height: $u.addUnit(height),
			}"
		>
		<!-- #endif -->
			<!-- #ifdef APP-NVUE -->
			<view
				class="u-slider__track__gap"
				ref="nvue-gap"
				:style="[
					barStyle,
					{
						backgroundColor: activeColor,
						height: $u.addUnit(height)
					}
				]"
			>
			<!-- #endif -->
			<!-- #ifndef APP-NVUE -->
			<view
				class="u-slider__gap u-slider__gap--ani"
				ref="nvue-gap"
				:style="[
					barStyle,
					{
						backgroundColor: activeColor,
						height: $u.addUnit(height),
					}
				]"
			>
			<!-- #endif -->
			</view>
		</view>
		<!-- #ifdef APP-NVUE -->
		<view
			class="u-slider__button-wrap"
			@touchstart="onTouchStart"
			@touchmove="onTouchMove"
			:style="[buttonWrapStyle, buttonWrapperStyle]"
			ref="nvue-button"
		>
		<!-- #endif -->
		<!-- #ifdef H5 || APP-VUE || MP-QQ || MP-WEIXIN -->
		<view
			class="u-slider__button-wrap"
			@touchstart="wxsModule.onTouchStart"
			@touchend="wxsModule.onTouchEnd"
			:style="[buttonWrapStyle, buttonWrapperStyle]"
			:change:prop="wxsModule.sizeReady"
			:prop="info"
		>
		<!-- #endif -->
			<slot>
				<view
					class="u-slider__button-wrap__button"
					:style="[buttonStyle]"
				></view>
			</slot>
		</view>
	</view>
</template>

<!-- #ifdef APP-VUE || MP-WEIXIN || H5 || MP-QQ -->
<script
	src="./mpwxs.wxs"
	module="wxsModule"
	lang="wxs"
></script>
<!-- #endif -->

<script>
	// #ifndef APP-PLUS || MP-WEIXIN || MP-QQ || H5 || APP-NVUE
	import mixins from './mpother'
	// #endif
	// #ifdef APP-VUE || MP-WEIXIN || H5 || MP-QQ
	import mixins from './mpwxs.js'
	// #endif
	// #ifdef APP-NVUE
	// import mixins from './nvue'
	// #endif
	import props from './props.js';
	import touch from '../../libs/mixin/touch.js'
	/**
	 * slider 滑块选择器
	 * @description 该组件一般用于表单中，手动选择一个区间范围的场景.
	 * @tutorial https://uviewui.com/components/slider.html
	 * @property {String | Number}	value			滑块默认值 
	 * @property {Boolean}			disabled		是否禁用滑块 
	 * @property {String | Number}	blockWidth		滑块宽度，高等于宽 
	 * @property {String | Number}	min				最小值 
	 * @property {String | Number}	max				最大值 
	 * @property {String | Number}	step			步长 
	 * @property {String | Number}	height			滑块条高度，单位px
	 * @property {String}			activeColor		底部选择部分的背景颜色
	 * @property {String}			inactiveColor	底部条背景颜色 
	 * @property {String}			blockColor		滑块颜色 
	 * @property {Object}			blockStyle		给滑块自定义样式，对象形式
	 * @property {Object}			customStyle		组件的样式，对象形式
	 * @event {Function} start	滑动触发 
	 * @event {Function} moving	正在滑动中
	 * @event {Function} end	滑动结束
	 * @example <u-slider v-model="value" />
	 */
	export default {
		name: 'u-slider',
		mixins: [uni.$u.mixin, props, touch],
		data() {
			return {
				// 滑动的状态有3个，start-开始 -> moving-移动中 -> end-结束
				status: 'end',
				barStyle: {},
				sliderRect: {},
				buttonWrapperStyle: {},
			}
		},
		computed: {
			buttonStyle() {
				// 滑块点的样式
				const style = {
					height: uni.$u.addUnit(this.blockHeight),
					width: uni.$u.addUnit(this.blockHeight),
					backgroundColor: this.blockColor
				}
				return uni.$u.deepMerge(uni.$u.addStyle(this.blockStyle), style)
			},
			buttonWrapStyle() {
				// 让元素垂直居中，top需要设置为父元素的50%，但是nvue不支持%写法
				let value = uni.$u.getPx(this.height)
				return {
					top: (value + 20) / 2 - this.blockHeight / 2 + 'px',
					// left: uni.$u.addUnit(-this.blockHeight / 2)
				}
			}
		},
		mounted() {

		},
		methods: {

		}
	};
</script>

<style lang="scss">
	@import "../../libs/css/components.scss";

	$u-slider-border-radius:999px !default;
	$u-slider-bgColor:#ebedf0 !default;
	$u-slider-gap-border-radius:999px !default;
	$u-slider-gap-bgColor:$u-primary !default;
	$u-slider-gap-width:0 !default;
	$u-slider-ani-transition:width 0.2s ease !default;
	$u-slider-button-wrap-top:50% !default;
	$u-slider-button-wrap-right:0 !default;
	$u-slider-button-wrap-transform: translate(0, -50%) !default;
	$u-slider-button-width:24px !default;
	$u-slider-button-height:24px !default;
	$u-slider-button-border-radius:100px !default;
	$u-slider-button-box-shadow:0 1px 2px rgba(0, 0, 0, 0.5) !default;
	$u-slider-button-bgColor:#fff !default;
	$u-slider-disabled-opacity:0.5 !default;

	.u-slider {
		position: relative;
		padding: 10px 0;

		&__track {
			border-top-right-radius: $u-slider-border-radius;
			border-top-left-radius: $u-slider-border-radius;
			border-bottom-right-radius: $u-slider-border-radius;
			border-bottom-left-radius: $u-slider-border-radius;
			background-color: $u-slider-bgColor;
			/* #ifndef APP-NVUE */
			touch-action: none;
			/* #endif */
			overflow: hidden;

			&__gap {
				border-top-right-radius: 0;
				border-top-left-radius: $u-slider-border-radius;
				border-bottom-right-radius: 0;
				border-bottom-left-radius: $u-slider-border-radius;
				background-color: $u-slider-gap-bgColor;
				width: 0;
				
				&--ani {
					transition: $u-slider-ani-transition;
				}
			}
		}


		&__button-wrap {
			position: absolute;
			top: 5px;
			// transform: $u-slider-button-wrap-transform;
			z-index: 3999;

			&__button {
				width: $u-slider-button-width;
				height: $u-slider-button-height;
				border-radius: $u-slider-button-border-radius;
				box-shadow: $u-slider-button-box-shadow;
				background-color: $u-slider-button-bgColor;
				/* #ifndef APP-NVUE */
				cursor: pointer;
				/* #endif */
				background-color: red;
			}
		}

		&--disabled {
			opacity: $u-slider-disabled-opacity;
		}
	}
</style>
